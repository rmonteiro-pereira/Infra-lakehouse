# apps/airflow/airflow-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: airflow-values
  namespace: airflow
  labels:
    app.kubernetes.io/part-of: airflow
    app.kubernetes.io/managed-by: flux
data:
  values.yaml: |
    executor: CeleryExecutor

    redis:
      enabled: false
    postgresql:
      enabled: false

    # metadataSecretName: postgresql://airflow:airflow-1717@postgresql.postgres.svc.cluster.local:5432/airflow
    # brokerUrl: redis://:Lazarus17@redis-master-master.redis.svc.cluster.local:6379/84
        
    data:
      # metadataSecretName: airflow-pg-conn # Keep this commented out for direct insertion
      metadataConnection: # This is an object with specific keys
        host: "postgresql.postgres.svc.cluster.local" # Your internal Kubernetes service hostname for PostgreSQL
        port: 5432
        user: "airflow" # Replace with your actual PostgreSQL username
        pass: "airflow-1717" # Replace with your actual PostgreSQL password - FOR TROUBLESHOOTING ONLY
        db: "airflow" # Replace with your actual PostgreSQL database name
        protocol: "postgresql" # Protocol for the connection
        sslmode: "disable" # Or "require", "prefer", etc., based on your PostgreSQL SSL setup. "disable" is common for internal non-SSL connections.
      brokerUrl:  redis://:Lazarus17@redis-master-master.redis.svc.cluster.local:6379/84

    webserver:
      replicas: 2
      livenessProbe:
        initialDelaySeconds: 60
        periodSeconds: 30
      waitForMigrations:
        enabled: true

    scheduler:
      replicas: 2
      livenessProbe:
        initialDelaySeconds: 120
        periodSeconds: 30

    workers:
      replicas: 2
      terminationGracePeriodSeconds: 600
    
    createUserJob:
      useHelmHooks: false
      applyCustomEnv: false
    migrateDatabaseJob:
      useHelmHooks: false
      applyCustomEnv: false






   

  