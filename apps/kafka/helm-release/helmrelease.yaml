apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: kafka
  namespace: kafka
spec:
  interval: 5m
  chartRef:
    kind: OCIRepository
    name: bitnami-kafka
    namespace: flux-system
  releaseName: kafka
  targetNamespace: kafka
  postRenderers:
    - kustomize:
        images:
          # Replace bitnami images with bitnamilegacy
          - name: docker.io/bitnami/kafka
            newName: docker.io/bitnamilegacy/kafka
            # Keep the tag as-is - chart will provide the version
  values:
    # Single broker setup
    replicaCount: 1
    
    # Persistent storage
    persistence:
      enabled: true
      storageClass: local-path
      size: 100Gi
    
    # Authentication - simple password for now
    auth:
      clientProtocol: sasl
      interBrokerProtocol: plaintext
      jaas:
        clientUsers:
          - admin
        clientPasswords:
          - admin
        interBrokerUser: admin
        interBrokerPassword: admin
    
    # Resources
    resources:
      requests:
        cpu: "500m"
        memory: "1Gi"
      limits:
        cpu: "1000m"
        memory: "2Gi"

