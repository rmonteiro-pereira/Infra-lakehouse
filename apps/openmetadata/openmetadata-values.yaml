# apps/openmetadata/openmetadata-values.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: openmetadata-values
  namespace: openmetadata
  labels:
    app.kubernetes.io/part-of: openmetadata
    app.kubernetes.io/managed-by: flux
data:
  values.yaml: |
    # Disable subcharts - using external services
    mysql:
      enabled: false
    elasticsearch:
      enabled: false
    kafka:
      enabled: false
    airflow:
      enabled: false
    
    # Configure PostgreSQL database connection
    # Override database configuration to use PostgreSQL instead of MySQL
    # The chart generates openmetadata-config-secret with DB_* environment variables
    database:
      driverClass: "org.postgresql.Driver"
      host: "postgresql.postgres.svc.cluster.local"
      port: 5432
      user: "openmetadata_user"
      dbName: "openmetadata_db"
      scheme: "postgresql"
      passwordSecret:
        name: "openmetadata-db-secret"
        key: "password"
    
    # Also set environment variables for both init and main containers
    openMetadataServerSpec:
      env:
        - name: DB_DRIVER_CLASS
          value: "org.postgresql.Driver"
        - name: DB_HOST
          value: "postgresql.postgres.svc.cluster.local"
        - name: DB_PORT
          value: "5432"
        - name: DB_USER
          value: "openmetadata_user"
        - name: OM_DATABASE
          value: "openmetadata_db"
        - name: DB_SCHEME
          value: "postgresql"
        - name: DB_PARAMS
          value: ""
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: openmetadata-db-secret
              key: password
        - name: DB_USER_PASSWORD
          valueFrom:
            secretKeyRef:
              name: openmetadata-db-secret
              key: password

