# apps/openmetadata/openmetadata-values.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: openmetadata-values
  namespace: openmetadata
  labels:
    app.kubernetes.io/part-of: openmetadata
    app.kubernetes.io/managed-by: flux
data:
  values.yaml: |
    # Disable subcharts - using external services
    mysql:
      enabled: false
    elasticsearch:
      enabled: false
    kafka:
      enabled: false
    airflow:
      enabled: false
    
    # Configure PostgreSQL database connection for OpenMetadata chart v1.11.x
    # Using correct schema: openmetadata.config.database with host/port/driverClass/dbScheme
    openmetadata:
      config:
        database:
          host: "postgresql.postgres.svc.cluster.local"
          port: 5432
          driverClass: "org.postgresql.Driver"
          dbScheme: "postgresql"
          databaseName: "openmetadata_db"
          auth:
            username: "openmetadata_user"
            password:
              secretRef: "openmetadata-db-secret"
              secretKey: "password"
      
      # Configure Elasticsearch connection for OpenMetadata chart v1.11.x
      # Using external Elasticsearch configuration
      elasticsearch:
        host: "elasticsearch-master.elasticsearch.svc.cluster.local"
        port: 9200
        scheme: "http"
        username: "elastic"
        password:
          secretRef: "openmetadata-elasticsearch-secret"
          secretKey: "password"
        connectionTimeoutSecs: 5
        socketTimeoutSecs: 60
      
      # Force search type to elasticsearch (not opensearch)
      extraEnvVars:
        - name: SEARCH_TYPE
          value: "elasticsearch"
        # Configure admin user - change from default admin@open-metadata.org
        - name: AUTHORIZER_ADMIN_PRINCIPALS
          value: '["admin"]'
        - name: AUTHORIZER_PRINCIPAL_DOMAIN
          value: "vanir-proxmox.duckdns.org"
        # Configure admin password from secret
        - name: AUTHORIZER_ADMIN_PASSWORD
          valueFrom:
            secretKeyRef:
              name: openmetadata-admin-secret
              key: password

