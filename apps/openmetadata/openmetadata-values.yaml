# apps/openmetadata/openmetadata-values.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: openmetadata-values
  namespace: openmetadata
  labels:
    app.kubernetes.io/part-of: openmetadata
    app.kubernetes.io/managed-by: flux
data:
  values.yaml: |
    # Disable subcharts - using external services
    mysql:
      enabled: false
    elasticsearch:
      enabled: false
    kafka:
      enabled: false
    airflow:
      enabled: false
    
    # Configure PostgreSQL database connection via environment variables
    # The OpenMetadata chart generates openmetadata-config-secret based on MySQL subchart
    # Since we disabled MySQL, we need to override via openMetadataServerSpec.extraEnv
    # These env vars will override the config secret values
    openMetadataServerSpec:
      extraEnv:
        - name: DB_DRIVER_CLASS
          value: "org.postgresql.Driver"
        - name: DB_HOST
          value: "postgresql.postgres.svc.cluster.local"
        - name: DB_PORT
          value: "5432"
        - name: DB_USER
          value: "openmetadata_user"
        - name: OM_DATABASE
          value: "openmetadata_db"
        - name: DB_SCHEME
          value: "postgresql"
        - name: DB_PARAMS
          value: ""
        - name: DB_PASSWORD
          valueFrom:
            secretKeyRef:
              name: openmetadata-db-secret
              key: password
        - name: DB_USER_PASSWORD
          valueFrom:
            secretKeyRef:
              name: openmetadata-db-secret
              key: password

